<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.9" /><meta name="theme" content="VuePress Theme Plume 1.0.0-rc.52" /><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;if (um === 'dark' || (um !== 'light' && sm)) {document.documentElement.classList.add('dark');}})();</script><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><title>sql进阶 | 博客</title><meta name="description" content="欢迎来到博客"><link rel="preload" href="/assets/style-sPKmHi9O.css" as="style"><link rel="stylesheet" href="/assets/style-sPKmHi9O.css"><link rel="modulepreload" href="/assets/app-CHQIiBnY.js"><link rel="modulepreload" href="/assets/index.html-CPTXWx8p.js"><link rel="prefetch" href="/assets/index.html-P5O9ymRf.js" as="script"><link rel="prefetch" href="/assets/index.html-C4n2OZGX.js" as="script"><link rel="prefetch" href="/assets/index.html-DRakEfZZ.js" as="script"><link rel="prefetch" href="/assets/index.html-BW9NW_PE.js" as="script"><link rel="prefetch" href="/assets/index.html-CwHrs2fL.js" as="script"><link rel="prefetch" href="/assets/index.html-CEOCWfyy.js" as="script"><link rel="prefetch" href="/assets/index.html-BFnXwMCm.js" as="script"><link rel="prefetch" href="/assets/index.html-Dj3Ix8CQ.js" as="script"><link rel="prefetch" href="/assets/index.html-BdYtd8AS.js" as="script"><link rel="prefetch" href="/assets/index.html-BCcm8How.js" as="script"><link rel="prefetch" href="/assets/index.html-BijEZI3V.js" as="script"><link rel="prefetch" href="/assets/index.html-CgnHJWio.js" as="script"><link rel="prefetch" href="/assets/index.html-BsAhXAZz.js" as="script"><link rel="prefetch" href="/assets/index.html-DTsu3frG.js" as="script"><link rel="prefetch" href="/assets/index.html-BiJZO9BF.js" as="script"><link rel="prefetch" href="/assets/index.html-D_nWUAE9.js" as="script"><link rel="prefetch" href="/assets/index.html-CX5zHxA2.js" as="script"><link rel="prefetch" href="/assets/index.html-C6OSLl2r.js" as="script"><link rel="prefetch" href="/assets/index.html-Dmq4qG72.js" as="script"><link rel="prefetch" href="/assets/index.html-Dv2HugiW.js" as="script"><link rel="prefetch" href="/assets/index.html-CJQbFbQH.js" as="script"><link rel="prefetch" href="/assets/index.html-7psB-xlV.js" as="script"><link rel="prefetch" href="/assets/index.html-R0ti6a4s.js" as="script"><link rel="prefetch" href="/assets/index.html-7C-wYHL9.js" as="script"><link rel="prefetch" href="/assets/index.html-D4RZSTlI.js" as="script"><link rel="prefetch" href="/assets/index.html-DhdLFuDj.js" as="script"><link rel="prefetch" href="/assets/index.html-CZ4paJh-.js" as="script"><link rel="prefetch" href="/assets/index.html-BqwGRJdo.js" as="script"><link rel="prefetch" href="/assets/index.html-Dzhdrqfo.js" as="script"><link rel="prefetch" href="/assets/index.html-CTX9JSyu.js" as="script"><link rel="prefetch" href="/assets/index.html-BJox3PSp.js" as="script"><link rel="prefetch" href="/assets/index.html-BZNXV70R.js" as="script"><link rel="prefetch" href="/assets/index.html-ezEjVihU.js" as="script"><link rel="prefetch" href="/assets/index.html-U4R2ie_6.js" as="script"><link rel="prefetch" href="/assets/index.html-CRCGn5vH.js" as="script"><link rel="prefetch" href="/assets/index.html-DO6eUd6i.js" as="script"><link rel="prefetch" href="/assets/index.html-BmZELFw0.js" as="script"><link rel="prefetch" href="/assets/index.html-dFwGkf62.js" as="script"><link rel="prefetch" href="/assets/index.html-BqFROzVN.js" as="script"><link rel="prefetch" href="/assets/index.html-DnKAi0g7.js" as="script"><link rel="prefetch" href="/assets/index.html-Cog8eiDT.js" as="script"><link rel="prefetch" href="/assets/index.html-CkVzSJSa.js" as="script"><link rel="prefetch" href="/assets/index.html-BWrPpH_l.js" as="script"><link rel="prefetch" href="/assets/index.html-BjhDwID4.js" as="script"><link rel="prefetch" href="/assets/index.html-dsJ4zsWb.js" as="script"><link rel="prefetch" href="/assets/index.html-BNSqpcHW.js" as="script"><link rel="prefetch" href="/assets/index.html-D_iw3fXc.js" as="script"><link rel="prefetch" href="/assets/index.html-CDqPFBMS.js" as="script"><link rel="prefetch" href="/assets/index.html-DG9wKGE_.js" as="script"><link rel="prefetch" href="/assets/index.html-3ArkfmY1.js" as="script"><link rel="prefetch" href="/assets/index.html-GQooVduZ.js" as="script"><link rel="prefetch" href="/assets/index.html-BtxDsmmn.js" as="script"><link rel="prefetch" href="/assets/index.html-EonBFtO9.js" as="script"><link rel="prefetch" href="/assets/index.html-5MRJUs92.js" as="script"><link rel="prefetch" href="/assets/index.html-CxshhEs9.js" as="script"><link rel="prefetch" href="/assets/index.html-67_Ggkd3.js" as="script"><link rel="prefetch" href="/assets/index.html-DjG1qRFK.js" as="script"><link rel="prefetch" href="/assets/index.html-DGN2Ohsj.js" as="script"><link rel="prefetch" href="/assets/index.html-fv2CIo17.js" as="script"><link rel="prefetch" href="/assets/index.html-BIxANljp.js" as="script"><link rel="prefetch" href="/assets/index.html-CTBL2XkP.js" as="script"><link rel="prefetch" href="/assets/index.html-BhSBzWQX.js" as="script"><link rel="prefetch" href="/assets/index.html-2Bg-zfCH.js" as="script"><link rel="prefetch" href="/assets/index.html-k-DZ4VUb.js" as="script"><link rel="prefetch" href="/assets/index.html-BLktw-_Y.js" as="script"><link rel="prefetch" href="/assets/index.html-DCzqI8iM.js" as="script"><link rel="prefetch" href="/assets/index.html-BiBWY16d.js" as="script"><link rel="prefetch" href="/assets/index.html-DTVrLIj9.js" as="script"><link rel="prefetch" href="/assets/index.html-D1sOksyJ.js" as="script"><link rel="prefetch" href="/assets/index.html-D4GmwSD0.js" as="script"><link rel="prefetch" href="/assets/index.html-DyNWyMGs.js" as="script"><link rel="prefetch" href="/assets/index.html-DK2kGPt8.js" as="script"><link rel="prefetch" href="/assets/index.html-D5BSY7DY.js" as="script"><link rel="prefetch" href="/assets/index.html-BItgu39e.js" as="script"><link rel="prefetch" href="/assets/index.html-BkA5qhPx.js" as="script"><link rel="prefetch" href="/assets/index.html-X9onHQ6Q.js" as="script"><link rel="prefetch" href="/assets/index.html-BGyL8QeX.js" as="script"><link rel="prefetch" href="/assets/index.html-BFwLaNU8.js" as="script"><link rel="prefetch" href="/assets/index.html-CKoPsVJZ.js" as="script"><link rel="prefetch" href="/assets/404.html-aBHYtIVx.js" as="script"><link rel="prefetch" href="/assets/index.html-BSmtbfKT.js" as="script"><link rel="prefetch" href="/assets/index.html-BhSN0Nhe.js" as="script"><link rel="prefetch" href="/assets/index.html-lKWjAx77.js" as="script"><link rel="prefetch" href="/assets/SearchBox-CYwgx_hH.js" as="script"></head><body><div id="app"><!--[--><div class="theme-plume" data-v-eb0efd70><!--[--><!--[--><span tabindex="-1" data-v-a5cce53b></span><a href="#LayoutContent" class="skip-link visually-hidden" data-v-a5cce53b> Skip to content </a><!--]--><!----><div class="nav-wrapper" data-v-eb0efd70 data-v-56aabd22><div class="navbar-wrapper" data-v-56aabd22 data-v-685bd9cf><div class="container" data-v-685bd9cf><div class="title" data-v-685bd9cf><div class="navbar-title" data-v-685bd9cf data-v-3177d4bf><a class="auto-link link title" href="/" data-v-3177d4bf data-v-8951c46f><!--[--><!----> 博客<!--]--><!----></a></div></div><div class="content" data-v-685bd9cf><div class="curtain" data-v-685bd9cf></div><div class="content-body" data-v-685bd9cf><div class="navbar-search search" data-v-685bd9cf><div class="search-wrapper" data-v-dbf6c040><!----><div id="local-search" data-v-dbf6c040><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-dbf6c040><span class="mini-search-button-container"><svg class="mini-search-search-icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="navbar-menu menu" data-v-685bd9cf data-v-e554bd69><span id="main-nav-aria-label" class="visually-hidden" data-v-e554bd69>Main Navigation</span><!--[--><!--[--><a class="auto-link link navbar-menu-link" href="/" data-v-e554bd69 data-v-38290752 data-v-8951c46f><!--[--><!----><i data-v-38290752>首页</i><!--]--><!----></a><!--]--><!--[--><a class="auto-link link navbar-menu-link" href="/blog/" data-v-e554bd69 data-v-38290752 data-v-8951c46f><!--[--><!----><i data-v-38290752>博客</i><!--]--><!----></a><!--]--><!--[--><a class="auto-link link navbar-menu-link" href="/myRpc/" data-v-e554bd69 data-v-38290752 data-v-8951c46f><!--[--><!----><i data-v-38290752>RPC框架</i><!--]--><!----></a><!--]--><!--[--><a class="auto-link link navbar-menu-link" href="/interview/" data-v-e554bd69 data-v-38290752 data-v-8951c46f><!--[--><!----><i data-v-38290752>八股文</i><!--]--><!----></a><!--]--><!--[--><a class="auto-link link navbar-menu-link" href="/study/" data-v-e554bd69 data-v-38290752 data-v-8951c46f><!--[--><!----><i data-v-38290752>春招</i><!--]--><!----></a><!--]--><!--]--></nav><!----><div class="navbar-appearance appearance" data-v-685bd9cf data-v-de2ce1e2><button class="switch-wrapper switch-appearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-de2ce1e2 data-v-b4a985f8 data-v-d7679eb1><span class="check" data-v-d7679eb1><span class="icon" data-v-d7679eb1><!--[--><span class="vpi-sun sun" data-v-b4a985f8></span><span class="vpi-moon moon" data-v-b4a985f8></span><!--]--></span></span></button></div><!----><div class="flyout-wrapper navbar-extra extra" data-v-685bd9cf data-v-1d5f4770 data-v-41d6a1d8><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-41d6a1d8><span class="vpi-more-horizontal icon" data-v-41d6a1d8></span></button><div class="menu" data-v-41d6a1d8><div class="menu-wrapper" data-v-41d6a1d8 data-v-2aa2bb29><!----><!--[--><!--[--><!----><div class="group" data-v-1d5f4770><div class="item appearance" data-v-1d5f4770><p class="label" data-v-1d5f4770>外观</p><div class="appearance-action" data-v-1d5f4770><button class="switch-wrapper switch-appearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-1d5f4770 data-v-b4a985f8 data-v-d7679eb1><span class="check" data-v-d7679eb1><span class="icon" data-v-d7679eb1><!--[--><span class="vpi-sun sun" data-v-b4a985f8></span><span class="vpi-moon moon" data-v-b4a985f8></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><button type="button" class="navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-685bd9cf data-v-c856f8d3><span class="container" data-v-c856f8d3><span class="top" data-v-c856f8d3></span><span class="middle" data-v-c856f8d3></span><span class="bottom" data-v-c856f8d3></span></span></button></div></div></div></div><!----></div><div class="local-nav reached-top is-blog" data-v-eb0efd70 data-v-50955389><button class="hidden menu" disabled aria-expanded="false" aria-controls="SidebarNav" data-v-50955389><span class="vpi-align-left menu-icon" data-v-50955389></span><span class="menu-text" data-v-50955389>Menu</span></button><div class="local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-50955389 data-v-969759bd><button class="" data-v-969759bd>此页内容 <span class="vpi-chevron-right icon" data-v-969759bd></span></button><!----></div></div><!----><div id="LayoutContent" class="layout-content" data-v-eb0efd70 data-v-63367bdf><!--[--><div class="has-aside is-blog plume-page" data-v-0b649db1><div class="container" data-v-0b649db1><div class="aside" data-v-0b649db1><div class="aside-container" data-v-0b649db1><div class="aside-content" data-v-0b649db1><div class="page-aside" data-v-0b649db1 data-v-ffc2a4d7><div class="has-outline page-aside-outline" data-v-ffc2a4d7><div class="content" data-v-ffc2a4d7><div class="outline-marker" data-v-ffc2a4d7></div><div class="outline-title" data-v-ffc2a4d7><span data-v-ffc2a4d7>此页内容</span><span class="vpi-print icon" data-v-ffc2a4d7></span></div><nav aria-labelledby="doc-outline-aria-label" data-v-ffc2a4d7><span id="doc-outline-aria-label" class="visually-hidden" data-v-ffc2a4d7> Table of Contents for current page </span><ul class="root" data-v-ffc2a4d7 data-v-a2310447><!--[--><li data-v-a2310447><a class="outline-link" href="#cross-join" data-v-a2310447>cross join</a><!----></li><li data-v-a2310447><a class="outline-link" href="#inner-join" data-v-a2310447>inner join</a><!----></li><li data-v-a2310447><a class="outline-link" href="#outer-join" data-v-a2310447>outer join</a><!----></li><li data-v-a2310447><a class="outline-link" href="#子查询" data-v-a2310447>子查询</a><!----></li><li data-v-a2310447><a class="outline-link" href="#exists" data-v-a2310447>exists</a><!----></li><li data-v-a2310447><a class="outline-link" href="#组合查询" data-v-a2310447>组合查询</a><!----></li><li data-v-a2310447><a class="outline-link" href="#开窗函数-sum-over" data-v-a2310447>开窗函数 - sum over</a><!----></li><li data-v-a2310447><a class="outline-link" href="#开窗函数-sum-over-order-by" data-v-a2310447>开窗函数 - sum over order by</a><!----></li><li data-v-a2310447><a class="outline-link" href="#开窗函数-rank" data-v-a2310447>开窗函数 - rank</a><!----></li><li data-v-a2310447><a class="outline-link" href="#开窗函数-row-number" data-v-a2310447>开窗函数 - row_number</a><!----></li><li data-v-a2310447><a class="outline-link" href="#开窗函数-lag-lead" data-v-a2310447>开窗函数 - lag / lead</a><!----></li><!--]--></ul></nav></div></div></div></div></div></div><div class="content" data-v-0b649db1><div class="content-container" data-v-0b649db1><!--[--><!----><h1 class="page-title" data-v-c3361043>sql进阶</h1><div class="page-meta-wrapper" data-v-c3361043><!----><p class="reading-time" data-v-c3361043><span class="vpi-books icon" data-v-c3361043></span><span data-v-c3361043>3423字</span><span data-v-c3361043>约11分钟</span></p><!----><p class="create-time" data-v-c3361043><span class="vpi-clock icon" data-v-c3361043></span><span data-v-c3361043>2024-06-04</span></p></div><!--]--><!--[--><div style="position:relative;" data-v-0b649db1><div class="plume-content" data-v-0b649db1><h1 id="进阶" tabindex="-1"><a class="header-anchor" href="#进阶"><span>进阶</span></a></h1><h2 id="cross-join" tabindex="-1"><a class="header-anchor" href="#cross-join"><span>cross join</span></a></h2><p><code>CROSS JOIN</code> 是一种简单的关联查询，不需要任何条件来匹配行，它直接将左表的 <strong>每一行</strong> 与右表的 <strong>每一行</strong> 进行组合，返回的结果是两个表的笛卡尔积。</p><p>如：有一个学生表 <code>student</code> ，包含以下字段：id（学号）、name（姓名）、age（年龄）、class_id（班级编号）；还有一个班级表 <code>class</code> ，包含以下字段：id（班级编号）、name（班级名称）。</p><p>请你编写一个 SQL 查询，将学生表和班级表的所有行组合在一起，并返回学生姓名（student_name）、学生年龄（student_age）、班级编号（class_id）以及班级名称（class_name）。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">select</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student_name, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">age</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student_age, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">class_id</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_name </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student s </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">cross join</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class c;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="inner-join" tabindex="-1"><a class="header-anchor" href="#inner-join"><span>inner join</span></a></h2><p>在 SQL 中，INNER JOIN 是一种常见的关联查询方式，它根据两个表之间的关联条件，将满足条件的行组合在一起。</p><p>注意，INNER JOIN 只返回两个表中满足关联条件的交集部分，即在两个表中都存在的匹配行。</p><p>如：有一个学生表 <code>student</code>，包含以下字段：<code>id</code>（学号）、<code>name</code>（姓名）、<code>age</code>（年龄）、<code>class_id</code>（班级编号）。还有一个班级表 <code>class</code>，包含以下字段：<code>id</code>（班级编号）、<code>name</code>（班级名称）、<code>level</code>（班级级别）。</p><p>请你编写一个 SQL 查询，根据学生表和班级表之间的班级编号进行匹配，返回学生姓名（<code>student_name</code>）、学生年龄（<code>student_age</code>）、班级编号（<code>class_id</code>）、班级名称（<code>class_name</code>）、班级级别（<code>class_level</code>）。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">select</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student_name, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">age</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student_age, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">class_id</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_name, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">level</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_level </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student s </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">join</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class c </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">on</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">class_id</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> =</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">id</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="outer-join" tabindex="-1"><a class="header-anchor" href="#outer-join"><span>outer join</span></a></h2><p>OUTER JOIN 是一种关联查询方式，它根据指定的关联条件，将两个表中满足条件的行组合在一起，并 <strong>包含没有匹配的行</strong> 。</p><p>在 OUTER JOIN 中，包括 LEFT OUTER JOIN 和 RIGHT OUTER JOIN 两种类型，它们分别表示查询左表和右表的所有行（即使没有被匹配），再加上满足条件的交集部分。</p><p>如：有一个学生表 <code>student</code>，包含以下字段：<code>id</code>（学号）、<code>name</code>（姓名）、<code>age</code>（年龄）、<code>class_id</code>（班级编号）。还有一个班级表 <code>class</code>，包含以下字段：<code>id</code>（班级编号）、<code>name</code>（班级名称）、<code>level</code>（班级级别）。</p><p>请你编写一个 SQL 查询，根据学生表和班级表之间的班级编号进行匹配，返回学生姓名（<code>student_name</code>）、学生年龄（<code>student_age</code>）、班级编号（<code>class_id</code>）、班级名称（<code>class_name</code>）、班级级别（<code>class_level</code>），要求必须返回所有学生的信息（即使对应的班级编号不存在）。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">select</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student_name, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">age</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student_age, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">class_id</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_name, </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">level</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_level </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student s </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">left join</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class c </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">on</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">class_id</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> =</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">id</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="子查询" tabindex="-1"><a class="header-anchor" href="#子查询"><span>子查询</span></a></h2><p>子查询是指在一个查询语句内部 <strong>嵌套</strong> 另一个完整的查询语句，内层查询被称为子查询。子查询可以用于获取更复杂的查询结果或者用于过滤数据。</p><p>当执行包含子查询的查询语句时，数据库引擎会首先执行子查询，然后将其结果作为条件或数据源来执行外层查询。</p><p>如：</p><p>有一个学生表 <code>student</code>，包含以下字段：<code>id</code>（学号）、<code>name</code>（姓名）、<code>age</code>（年龄）、<code>score</code>（分数）、<code>class_id</code>（班级编号）。还有一个班级表 <code>class</code>，包含以下字段：<code>id</code>（班级编号）、<code>name</code>（班级名称）。</p><p>请你编写一个 SQL 查询，使用子查询的方式来获取存在对应班级的学生的所有数据，返回学生姓名（<code>name</code>）、分数（<code>score</code>）、班级编号（<code>class_id</code>）字段。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">select</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, score, class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">where</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">in</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">select distinct</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="exists" tabindex="-1"><a class="header-anchor" href="#exists"><span>exists</span></a></h2><p>子查询是一种强大的查询工具，它可以嵌套在主查询中，帮助我们进行更复杂的条件过滤和数据检索。</p><p>其中，子查询中的一种特殊类型是 &quot;exists&quot; 子查询，用于检查主查询的结果集是否存在满足条件的记录，它返回布尔值（True 或 False），而不返回实际的数据。</p><p>如：有一个学生表 <code>student</code>，包含以下字段：<code>id</code>（学号）、<code>name</code>（姓名）、<code>age</code>（年龄）、<code>score</code>（分数）、<code>class_id</code>（班级编号）。还有一个班级表 <code>class</code>，包含以下字段：<code>id</code>（班级编号）、<code>name</code>（班级名称）。</p><p>请你编写一个 SQL 查询，使用 exists 子查询的方式来获取 <strong>不存在对应班级的</strong> 学生的所有数据，返回学生姓名（<code>name</code>）、年龄（<code>age</code>）、班级编号（<code>class_id</code>）字段。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">select</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, age, class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">where</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> not</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> exists</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">select</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">where</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> class</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">id</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> =</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> student</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">class_id</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="组合查询" tabindex="-1"><a class="header-anchor" href="#组合查询"><span>组合查询</span></a></h2><p>在 SQL 中，组合查询是一种将多个 SELECT 查询结果合并在一起的查询操作。</p><p>包括两种常见的组合查询操作：UNION 和 UNION ALL。</p><ol><li>UNION 操作：它用于将两个或多个查询的结果集合并， <strong>并去除重复的行</strong> 。即如果两个查询的结果有相同的行，则只保留一行。</li><li>UNION ALL 操作：它也用于将两个或多个查询的结果集合并， <strong>但不去除重复的行</strong> 。即如果两个查询的结果有相同的行，则全部保留。</li></ol><p>如：有一个学生表 <code>student</code>，包含以下字段：<code>id</code>（学号）、<code>name</code>（姓名）、<code>age</code>（年龄）、<code>score</code>（分数）、<code>class_id</code>（班级编号）。还有一个新学生表 <code>student_new</code>，包含的字段和学生表完全一致。</p><p>请编写一条 SQL 语句，获取所有学生表和新学生表的学生姓名（<code>name</code>）、年龄（<code>age</code>）、分数（<code>score</code>）、班级编号（<code>class_id</code>）字段，要求保留重复的学生记录。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">select</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, age, score, class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">union all</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> select</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, age, score, class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student_new;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="开窗函数-sum-over" tabindex="-1"><a class="header-anchor" href="#开窗函数-sum-over"><span>开窗函数 - sum over</span></a></h2><p>在 SQL 中，开窗函数是一种强大的查询工具，它允许我们在查询中进行对分组数据进行计算、 <strong>同时保留原始行的详细信息</strong> 。</p><p>开窗函数可以与聚合函数（如 SUM、AVG、COUNT 等）结合使用，但与普通聚合函数不同，开窗函数不会导致结果集的行数减少。</p><p>打个比方，可以将开窗函数想象成一种 &quot;透视镜&quot;，它能够将我们聚焦在某个特定的分组，同时还能看到整体的全景。</p><p>本节我们先讲第一个开窗函数：sum over。</p><p>该函数用法为：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">SUM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(计算字段名) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 分组字段名)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如：有一个学生表 <code>student</code>，包含以下字段：<code>id</code>（学号）、<code>name</code>（姓名）、<code>age</code>（年龄）、<code>score</code>（分数）、<code>class_id</code>（班级编号）。</p><p>请你编写一个 SQL 查询，返回每个学生的详细信息（字段顺序和原始表的字段顺序一致），并计算每个班级的学生平均分（class_avg_score）。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id, </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, age, score, class_id, </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">AVG</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(score) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_avg_score </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="开窗函数-sum-over-order-by" tabindex="-1"><a class="header-anchor" href="#开窗函数-sum-over-order-by"><span>开窗函数 - sum over order by</span></a></h2><p>我们讲到了 sum over 开窗函数，并且用它实现了分组统计。</p><p>本节教程我们将学习 sum over 函数的另一种用法：sum over order by，可以实现同组内数据的 <strong>累加求和</strong> 。</p><p>示例用法如下：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">SUM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(计算字段名) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 分组字段名 </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 排序字段 排序规则)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>举一个应用场景：老师在每个班级里依次点名，每点到一个学生，老师都会记录当前已点到的学生们的分数总和。</p><p>如：一个学生表 <code>student</code>，包含以下字段：<code>id</code>（学号）、<code>name</code>（姓名）、<code>age</code>（年龄）、<code>score</code>（分数）、<code>class_id</code>（班级编号）。</p><p>请你编写一个 SQL 查询，返回每个学生的详细信息（字段顺序和原始表的字段顺序一致），并且按照分数升序的方式累加计算每个班级的学生总分（class_sum_score）。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id, </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, age, score, class_id, </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">SUM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(score) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> score </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ASC</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_sum_score </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="开窗函数-rank" tabindex="-1"><a class="header-anchor" href="#开窗函数-rank"><span>开窗函数 - rank</span></a></h2><p>Rank 开窗函数是 SQL 中一种用于对查询结果集中的行进行 <strong>排名</strong> 的开窗函数。它可以根据指定的列或表达式对结果集中的行进行排序，并为每一行分配一个排名。在排名过程中，相同的值将被赋予相同的排名，而不同的值将被赋予不同的排名。</p><blockquote><p>当存在并列（相同排序值）时，Rank 会跳过后续排名，并保留相同的排名。</p></blockquote><p>Rank 开窗函数的常见用法是在查询结果中查找前几名（Top N）或排名最高的行。</p><p>Rank 开窗函数的语法如下：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">RANK</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">() </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">  PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 列名1, 列名2, ... </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 可选，用于指定分组列</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">  ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 列名3 [ASC|DESC], 列名4 [ASC|DESC], ... </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 用于指定排序列及排序方式</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> rank_column</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中，<code>PARTITION BY</code> 子句可选，用于指定分组列，将结果集按照指定列进行分组；<code>ORDER BY</code> 子句用于指定排序列及排序方式，决定了计算 Rank 时的排序规则。<code>AS rank_column</code> 用于指定生成的 Rank 排名列的别名。</p><p>如：有一个学生表 <code>student</code>，包含以下字段：<code>id</code>（学号）、<code>name</code>（姓名）、<code>age</code>（年龄）、<code>score</code>（分数）、<code>class_id</code>（班级编号）。</p><p>请你编写一个 SQL 查询，返回每个学生的详细信息（字段顺序和原始表的字段顺序一致），并且按照分数降序的方式计算每个班级内的学生的分数排名（ranking）。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id, </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, age, score, class_id, </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">RANK</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">() </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> score </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">DESC</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ranking </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="开窗函数-row-number" tabindex="-1"><a class="header-anchor" href="#开窗函数-row-number"><span>开窗函数 - row_number</span></a></h2><p>Row_Number 开窗函数是 SQL 中的一种用于为查询结果集中的每一行 <strong>分配唯一连续排名</strong> 的开窗函数。</p><p>它与之前讲到的 Rank 函数，Row_Number 函数为每一行都分配一个唯一的整数值，不管是否存在并列（相同排序值）的情况。每一行都有一个唯一的行号，从 1 开始连续递增。</p><p>Row_Number 开窗函数的语法如下（几乎和 Rank 函数一模一样）：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">ROW_NUMBER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">() </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">  PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> column1, column2, ... </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 可选，用于指定分组列</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">  ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> column3 [ASC|DESC], column4 [ASC|DESC], ... </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 用于指定排序列及排序方式</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> row_number_column</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中，<code>PARTITION BY</code>子句可选，用于指定分组列，将结果集按照指定列进行分组。<code>ORDER BY</code> 子句用于指定排序列及排序方式，决定了计算 Row_Number 时的排序规则。<code>AS row_number_column</code> 用于指定生成的行号列的别名。</p><p>如：有一个学生表 <code>student</code>，包含以下字段：<code>id</code>（学号）、<code>name</code>（姓名）、<code>age</code>（年龄）、<code>score</code>（分数）、<code>class_id</code>（班级编号）。</p><p>请你编写一个 SQL 查询，返回每个学生的详细信息（字段顺序和原始表的字段顺序一致），并且按照分数降序的方式给每个班级内的学生分配一个编号（row_number）。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id, </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, age, score, class_id, </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">ROW_NUMBER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">() </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> score </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">DESC</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> row_number </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="开窗函数-lag-lead" tabindex="-1"><a class="header-anchor" href="#开窗函数-lag-lead"><span>开窗函数 - lag / lead</span></a></h2><p>开窗函数 Lag 和 Lead 的作用是获取在当前行之前或之后的行的值，这两个函数通常在需要比较相邻行数据或进行时间序列分析时非常有用。</p><p>1）Lag 函数</p><p>Lag 函数用于获取 <strong>当前行之前</strong> 的某一列的值。它可以帮助我们查看上一行的数据。</p><p>Lag 函数的语法如下：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">LAG</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(column_name, offset, default_value) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> partition_column </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> sort_column)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>参数解释：</p><ul><li><code>column_name</code>：要获取值的列名。</li><li><code>offset</code>：表示要向上偏移的行数。例如，offset为1表示获取上一行的值，offset为2表示获取上两行的值，以此类推。</li><li><code>default_value</code>：可选参数，用于指定当没有前一行时的默认值。</li><li><code>PARTITION BY</code>和<code>ORDER BY</code>子句可选，用于分组和排序数据。</li></ul><p>2）Lead 函数</p><p>Lead 函数用于获取 <strong>当前行之后</strong> 的某一列的值。它可以帮助我们查看下一行的数据。</p><p>Lead 函数的语法如下：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">LEAD</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(column_name, offset, default_value) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> partition_column </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> sort_column)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>参数解释：</p><ul><li><code>column_name</code>：要获取值的列名。</li><li><code>offset</code>：表示要向下偏移的行数。例如，offset为1表示获取下一行的值，offset为2表示获取下两行的值，以此类推。</li><li><code>default_value</code>：可选参数，用于指定当没有后一行时的默认值。</li><li><code>PARTITION BY</code>和<code>ORDER BY</code>子句可选，用于分组和排序数据。</li></ul><p><strong>示例</strong></p><p>以下是一个示例，假设我们有一个学生成绩表<code>scores</code>，其中包含学生的成绩和考试日期：</p><table><thead><tr><th>student_id</th><th>exam_date</th><th>score</th></tr></thead><tbody><tr><td>101</td><td>2023-01-01</td><td>85</td></tr><tr><td>101</td><td>2023-01-05</td><td>78</td></tr><tr><td>101</td><td>2023-01-10</td><td>92</td></tr><tr><td>101</td><td>2023-01-15</td><td>80</td></tr></tbody></table><p>现在我们想要查询每个学生的考试日期和上一次考试的成绩，以及下一次考试的成绩，示例 SQL 如下：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    student_id,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    exam_date,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    score,</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    LAG</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(score, </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NULL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> exam_date) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> previous_score,</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    LEAD</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(score, </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NULL</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> exam_date) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> next_score</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    scores;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果将是：</p><table><thead><tr><th>student_id</th><th>exam_date</th><th>score</th><th>previous_score</th><th>next_score</th></tr></thead><tbody><tr><td>101</td><td>2023-01-01</td><td>85</td><td>NULL</td><td>78</td></tr><tr><td>101</td><td>2023-01-05</td><td>78</td><td>85</td><td>92</td></tr><tr><td>101</td><td>2023-01-10</td><td>92</td><td>78</td><td>80</td></tr><tr><td>101</td><td>2023-01-15</td><td>80</td><td>92</td><td>NULL</td></tr></tbody></table><p>在上面的示例中，我们使用 Lag 函数获取每个学生的上一次考试成绩（previous_score），使用 Lead 函数获取每个学生的下一次考试成绩（next_score）。如果没有上一次或下一次考试，对应的列将显示为 NULL。</p><p>如：有一个学生表 <code>student</code>，包含以下字段：<code>id</code>（学号）、<code>name</code>（姓名）、<code>age</code>（年龄）、<code>score</code>（分数）、<code>class_id</code>（班级编号）。</p><p>请你编写一个 SQL 查询，返回每个学生的详细信息（字段顺序和原始表的字段顺序一致），并且按照分数降序的方式获取每个班级内的学生的前一名学生姓名（prev_name）、后一名学生姓名（next_name）。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id, </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, age, score, class_id, </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">LAG</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">over</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> score </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">DESC</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">as</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> prev_name, </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">LEAD</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OVER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PARTITION</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> class_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ORDER BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> score </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">DESC</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> next_name </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> student;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><!----></div><footer class="page-footer" data-v-0b649db1 data-v-6789ec36><!----><div class="contributors" data-v-6789ec36><span class="contributors-label" data-v-6789ec36>贡献者: </span><span class="contributors-info" data-v-6789ec36><!--[--><!--[--><span class="contributor" title="email: 3027708213@qq.com" data-v-6789ec36>hongzidan</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-6789ec36><div class="pager" data-v-6789ec36><a class="auto-link link pager-link prev" href="/article/jxkuoi7x/" data-v-6789ec36 data-v-8951c46f><!--[--><span class="desc" data-v-6789ec36>上一页</span><span class="title" data-v-6789ec36>sql实战一</span><!--]--><!----></a></div><div class="pager" data-v-6789ec36><a class="auto-link link pager-link next" href="/article/ot2h5kr6/" data-v-6789ec36 data-v-8951c46f><!--[--><span class="desc" data-v-6789ec36>下一页</span><span class="title" data-v-6789ec36>SQL基础</span><!--]--><!----></a></div></nav></footer><!----><!--]--></div></div></div></div><button style="display:none;" type="button" class="back-to-top-button" aria-label="back to top" data-v-eb0efd70 data-v-b6c520c3><span class="percent" data-v-b6c520c3>0%</span><span class="show icon vpi-back-to-top" data-v-b6c520c3></span><svg aria-hidden="true" data-v-b6c520c3><circle cx="50%" cy="50%" style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-b6c520c3></circle></svg></button><footer class="plume-footer" data-v-eb0efd70 data-v-fc43f332><div class="container" data-v-fc43f332><p class="message" data-v-fc43f332>Power by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://github.com/pengzhanbo/vuepress-theme-plume">vuepress-theme-plume</a></p><!----></div></footer><!--]--></div><!--]--></div><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-CHQIiBnY.js" defer></script></body></html>