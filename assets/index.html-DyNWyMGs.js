import{_ as e,c as t,a,b as i,d as s,o as n}from"./app-CHQIiBnY.js";const h={};function r(k,l){return n(),t("div",null,l[0]||(l[0]=[a('<ol><li><strong>避免使用 select *</strong><ul><li>查询时需要将 * 解析为所有字段，<strong>增加查询解析器的成本</strong></li><li>查询出不需要的字段时浪费 <strong>CPU</strong> 和<strong>内存资源</strong></li><li>select * 查询一般不走覆盖索引</li><li>文本数据和大字段数据传输增加网络消耗</li></ul></li><li><strong>使用小表驱动大表</strong><ul><li>Join Buffer （连接缓冲区）是优化器用于处理连接查询操作时的临时缓冲区。简单来说当我们需要比较两个或多个表的数据进行Join操作时，Join Buffer可以帮助 MYSQL 临时存储结果，以减少磁盘读取和CPU负担，提高查询效率。需要注意的是每个join都有一个单独的缓冲区</li><li>Block nested-loop join（BNL算法）会将驱动表数据加载到 join buffer 里面，然后再批量与非驱动表进行匹配；如果驱动表数据量较大，join buffer无法一次性装载驱动表的结果集，将会分阶段与被驱动表进行批量数据匹配，会增加被驱动表的扫描次数，从而降低查询效率。所以开发中要遵守小表驱动大表的原则。</li></ul></li><li><strong>优先考虑连接查询而非子查询</strong><ul><li>子查询需要执行<strong>两次</strong>数据库查询，一次外部查询，一次嵌套子查询</li><li>连接查询可以利用表上的索引，子查询不行，另外子查询会使用临时表或内存表，因此连接查询可以更快访问表中的数据且减少资源的消耗</li></ul></li><li><strong>在无需排除重复项的时候优先使用 union all 而非 union</strong><ul><li>union all：获取所有数据但是数据不去重，包含重复数据</li><li>union：获取所有数据且数据去重，不包含重复数据</li></ul></li><li><strong>对 group by 字段创建 索引</strong><ul><li>B+ 树索引 以树形结构存储数据，适用于范围查询和精确查询，支持<strong>有序数据的快速查找</strong>、排序和聚合操作</li></ul></li><li><strong>减少 join 表数量</strong><ul><li>查询效率下降：多表JOIN查询数据对比时间边长</li><li>系统负载增加：JOIN操作需要进行大量的计算，因此会导致系统负载增加。</li><li>维护难度加大：在一个连接了多个表的查询中，如果需要修改其中一个表的结构或内容，就可能会需要同时修改其他表的结构或内容。</li></ul></li><li><strong>使用批量 插入和删除 代替 单个 操作</strong><ul><li>逐个操作会频繁与数据库进行交互，损耗性能（但是不建议一次批量操作太多数据，数据太多数据库响应也会很慢，建议每批操作控制在 500 <strong>以内</strong>）</li></ul></li><li><strong>使用 limit 约束数据量</strong><ul><li>提高查询效率：限制返回的数据行数，减轻系统负担，提高查询效率</li><li>避免过度提取数据，对于大型数据库系统，提取大量数据可能导致系统崩溃</li><li>优化分页查询。分页查询需要查询所有所有的数据才会进行分页处理，使用 limit 可以只查询需要的数据行，缩短查询时间</li></ul></li></ol><h3 id="扩展" tabindex="-1"><a class="header-anchor" href="#扩展"><span><strong>扩展</strong></span></a></h3><h4 id="百万级表-limit-翻页越往后越慢怎么办" tabindex="-1"><a class="header-anchor" href="#百万级表-limit-翻页越往后越慢怎么办"><span>百万级表 Limit 翻页越往后越慢怎么办？</span></a></h4>',3),i("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[i("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark vp-code","v-pre":""},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"select"),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}}," *"),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}}," from"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," table_name "),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"limit"),i("span",{style:{"--shiki-light":"#2F798A","--shiki-dark":"#4C9A91"}}," 10000"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},","),i("span",{style:{"--shiki-light":"#2F798A","--shiki-dark":"#4C9A91"}},"10")])])]),i("div",{class:"line-numbers","aria-hidden":"true"},[i("div",{class:"line-number"})])],-1),i("p",null,"这句 SQL 的执行逻辑是",-1),i("ol",null,[i("li",null,"从数据表中读取第N条数据添加到数据集中"),i("li",null,"重复第一步直到N=10000+10"),i("li",null,"根据 offset 抛弃前面 10000 条数"),i("li",null,"返回剩余的 10 条数据")],-1),i("p",null,"解决思路：先查找出需要数据的索引列（假设为 id ），再通过索引列查找出需要的数据。",-1),i("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[i("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark vp-code","v-pre":""},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"select"),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}}," *"),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}}," from"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," table_name "),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"where"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," id "),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"in"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," (")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"	select"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," id "),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"from"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," table_name ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"    where"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," (user "),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}},"="),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," XXX)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},") "),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"limit"),i("span",{style:{"--shiki-light":"#2F798A","--shiki-dark":"#4C9A91"}}," 10000"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},","),i("span",{style:{"--shiki-light":"#2F798A","--shiki-dark":"#4C9A91"}},"10")])])]),i("div",{class:"line-numbers","aria-hidden":"true"},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),i("p",null,"再次优化",-1),i("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[i("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark vp-code","v-pre":""},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"select"),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}}," *"),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}}," from"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," table_name "),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"where"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," id "),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"inner join"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," (")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"	select"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," id "),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"from"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," table_name ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"    where"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," (user "),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}},"="),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," XXX)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},") "),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"limit"),i("span",{style:{"--shiki-light":"#2F798A","--shiki-dark":"#4C9A91"}}," 10000"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},","),i("span",{style:{"--shiki-light":"#2F798A","--shiki-dark":"#4C9A91"}},"10")])])]),i("div",{class:"line-numbers","aria-hidden":"true"},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1)]))}const o=e(h,[["render",r],["__file","index.html.vue"]]),g=JSON.parse(`{"path":"/study/mf3x52jh/","title":"008、8 种 SQL 优化方式","lang":"zh-CN","frontmatter":{"title":"008、8 种 SQL 优化方式","author":null,"createTime":"2025/02/15 14:03:05","permalink":"/study/mf3x52jh/","head":[["script",{"id":"check-dark-mode"},";(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;if (um === 'dark' || (um !== 'light' && sm)) {document.documentElement.classList.add('dark');}})();"],["script",{"id":"check-mac-os"},"document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))"]]},"headers":[{"level":3,"title":"扩展","slug":"扩展","link":"#扩展","children":[]}],"readingTime":{"minutes":3.31,"words":993},"git":{"updatedTime":1740622614000,"contributors":[{"name":"洪子丹","email":"302778213@qq.com","commits":2}]},"filePathRelative":"notes/study/recite/008、8 种 SQL 优化方式.md"}`);export{o as comp,g as data};
